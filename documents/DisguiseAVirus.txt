So in this exercise we're going to look at how to disguise a virus, an executable, in the form of integers, an array of integers that can be shuffled so that it will pass an intrusion detection system. For example it could be disguised as a payload in Word or Excel and reconstitute it once we're on the host, on the victim's host, into an executable that can be executed from say a Word document. Okay so to do this we're going to need to get hold of a... So we're going to need to get hold of PowerShell. So this is Windows PowerShell. It's also available for Mac and Unix but you need to load that onto your machine and then start up the PowerShell. I'll just show you what it looks like here. So I just look for PowerShell, Windows PowerShell, and it brings up this kind of shell. Okay so let's go ahead now and take a look at a simple virus and see if we can disguise it. So here I've got a piece of C code. Basically it's just writing to the console "Hello world you are infected". So this is our little virus if you like that we want to implant maybe in your Word document or Excel spreadsheet. So if we compile this and we just use the C compiler then we'll get a .exe file and the .exe file starts the normal way for D5A etc. And so this executable may have a signature that could be recognized by Intrusion Detection Systems so what we want to do is to take this .exe file and make it into something that the Intrusion Detection System can't recognize. So we're going to actually turn it into a character string. So let's see how we do this. What we want to happen is that we use our virus .exe file so it's a string of bytes here and we want to turn it into a text file where these numbers represent these pairs here 45A is 77 this one is 90 etc. Okay so just by running this code here we get the content of virus .exe and we encode it into bytes in this temporary file hex here and then we're going to write that out to this file here whatever it is then I'm calling it dump .txt okay in my file system. So we run that in the PowerShell okay so here's our first instruction get content we're going to get the virus .exe file so that's done there then the next command we want to run is we want to run yeah write all lines and I'm writing it out here so boom write all lines it's done and it should be if we look now at our file dump .txt yeah here it is. So now I've got it in this form of a long character string and I can go one more step and actually push it into an array list so this is taking these characters pushing them into an array that is rather like a jigsaw puzzle now that I could shuffle these and unshuffle them in a little piece of code and it would be impossible for an intrusion detection system to tell what's going on. So that's the first part now once we've got this into our victims onto our victims computer we want to reconstitute it into an .exe so we need to go back and now what we want to do is to reconstitute this you know virus .exe and I'm going to call it evil payload here so to do that we need to do these three things here we need to get our dump .txt and we're going to split that and then we're going to write it as bytes into evil payload so let's go and see we can do those so we get the content to hex we want to do split so there's split and then finally we want to write out our evil file so here's our I'm writing it to use as jw evil payload okay and if I go there okay and if I run that hello world you're infected it's an executable and so we've done this round tripping between files so exe to text string and then back text string back to evil payload and that executes this is quite a fairly simple exploit but highly effective you you you you you you